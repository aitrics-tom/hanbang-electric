# 구현 계획: 문제 풀이 UI 개선 및 RAG 검증

## 요구사항 정리

1. **최종 정답 UI 개선** - 서술형 긴 답변이 예쁘게 표시되도록
2. **사용 공식 LaTeX 렌더링** - 현재 코드로 표시되는 부분 수정
3. **주의사항 LaTeX 렌더링** - 동일 이슈 수정
4. **RAG 검증** - KEC 규정 문서가 있는데도 "미확인"으로 표시되는 문제

---

## 분석 결과

### 문제 1: 최종 정답 UI (AnswerCard)
- **현재**: `text-4xl font-bold` 고정 스타일로 긴 텍스트 대응 불가
- **위치**: `SolutionDisplay.tsx:291-318`
- **해결**: 답변 길이에 따라 동적 스타일링 적용

### 문제 2: 사용 공식 LaTeX (FormulaCard)
- **현재**: 단순 텍스트로 출력 (`{formula}`)
- **위치**: `SolutionDisplay.tsx:466-483`
- **해결**: `LatexInlineRenderer` 컴포넌트 사용하여 LaTeX 렌더링

### 문제 3: 주의사항 LaTeX (VerificationCard)
- **현재**: 단순 텍스트로 출력 (`{warning}`)
- **위치**: `SolutionDisplay.tsx:556-571`
- **해결**: `LatexInlineRenderer` 컴포넌트 사용

### 문제 4: RAG KEC 검증 실패
- **원인 분석**:
  1. `doc/regulations/` 폴더에 KEC 문서 존재 확인됨
  2. `[전문] 2026년 한국전기설비규정...md` 파일에 `KEC 232.3.9` 등 포함
  3. 문제: 문서가 Supabase DB에 ingest되지 않은 것으로 추정
  4. `ingest.service.ts`는 `doc/` 폴더를 스캔하지만 실행 여부 불확실
- **해결**:
  1. RAG ingest 상태 확인
  2. 필요시 수동 ingest 실행
  3. 검색 로직 검증

---

## 구현 단계

### Phase 1: UI 개선 (SolutionDisplay.tsx)

#### 1.1 AnswerCard 개선
```typescript
// 답변 길이에 따른 동적 스타일링
const isLongAnswer = answer.length > 50;
const answerStyle = isLongAnswer
  ? 'text-xl md:text-2xl font-semibold leading-relaxed'
  : 'text-3xl md:text-4xl font-bold tracking-tight';
```

#### 1.2 FormulaCard LaTeX 렌더링
```typescript
// 기존
{formulas.map((formula) => (
  <span>{formula}</span>
))}

// 변경
{formulas.map((formula) => (
  <span><LatexInlineRenderer text={formula} /></span>
))}
```

#### 1.3 VerificationCard 주의사항 LaTeX 렌더링
```typescript
// 기존
<span>{warning}</span>

// 변경
<span><LatexInlineRenderer text={warning} /></span>
```

### Phase 2: RAG 검증

#### 2.1 현재 ingest 상태 확인
- `/api/rag/search` API 호출하여 KEC 코드 검색 테스트
- DB에 `documents` 및 `document_chunks` 데이터 존재 여부 확인

#### 2.2 문서 Ingest 실행 (필요시)
- `/api/rag/ingest` API 호출하여 `doc/regulations/` 폴더 수집
- 또는 로컬 스크립트로 ingest 실행

#### 2.3 KEC 검색 로직 개선
- `searchByKecCode` 함수가 정규식 패턴 매칭 지원하도록 개선
- 예: `KEC 232.3.9` → `KEC232.3.9`, `232.3.9` 등 다양한 포맷 대응

---

## 리스크

| 리스크 | 영향 | 대응 |
|--------|------|------|
| RAG DB 마이그레이션 필요 | 중 | 기존 데이터 백업 후 진행 |
| KaTeX 렌더링 오류 | 저 | try-catch로 fallback 처리 이미 구현됨 |
| 긴 답변 UI 깨짐 | 저 | responsive 클래스 적용 |

---

## 예상 복잡도: MEDIUM

- UI 개선: 단순 컴포넌트 수정 (~30분)
- RAG 검증: DB 상태에 따라 달라짐 (~1시간)

---

**WAITING FOR CONFIRMATION**: 이 계획으로 진행할까요? (yes/no/modify)
