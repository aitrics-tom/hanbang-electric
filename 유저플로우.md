# 한방전기 - 유저 플로우 및 기술 문서

> 이 문서는 중학생도 이해할 수 있게 쉽게 작성되었습니다.

---

## 1. 기술 스택 소개

### 우리 앱이 사용하는 기술들

| 기술 | 역할 | 쉬운 설명 |
|------|------|----------|
| **Next.js 15** | 웹사이트 뼈대 | 웹페이지를 만드는 도구. 레고 블록처럼 페이지를 조립해요 |
| **React 19** | 화면 그리기 | 버튼, 입력창 같은 것들을 예쁘게 그려주는 도구 |
| **TypeScript** | 안전한 코딩 | 코드에 오타가 있으면 미리 알려주는 맞춤법 검사기 |
| **Tailwind CSS** | 디자인 | 색깔, 크기, 위치를 쉽게 정하는 스타일 도구 |
| **Supabase** | 데이터 저장소 | 사용자 정보, 문제 기록을 저장하는 온라인 창고 |
| **Google Gemini AI** | 인공지능 두뇌 | 문제를 읽고 풀이를 생각해내는 똑똑한 AI |

### AI 멀티 에이전트 시스템

우리 앱에는 6명의 전문가 AI가 있어요:

| 에이전트 | 전문 분야 | 하는 일 |
|----------|----------|---------|
| **DESIGN** | 설계 및 시공 | 건물 전기 설계, 조명 계산 |
| **SEQUENCE** | 시퀀스 제어 | 자동화 회로, 타이머 문제 |
| **LOAD** | 부하 계산 | 전력 사용량, 케이블 크기 계산 |
| **POWER** | 전력 설비 | 변압기, 차단기 문제 |
| **RENEWABLE** | 신재생 에너지 | 태양광, 풍력 발전 |
| **KEC** | 전기 규정 | 한국전기설비규정 관련 |

```

---

## 2. AI 프롬프트 구조

### Vision AI (이미지 분석)

문제 사진을 업로드하면 이렇게 분석해요:

```
1. 이미지에서 텍스트 추출 (OCR)
2. 수식, 회로도 인식
3. 어떤 분야 문제인지 분류
4. 적절한 전문 에이전트 선택
```

### Solver AI (문제 풀이)

각 전문 에이전트는 이런 형식으로 답변해요:

```json
{
  "thinking": "문제 분석 과정...",
  "steps": [
    {
      "title": "1단계: 공식 확인",
      "content": "설명...",
      "formula": "P = V × I"
    }
  ],
  "answer": "최종 답",
  "formulas": ["사용한 공식들"],
  "keyPoints": ["핵심 포인트"]
}
```

### Analytics AI (학습 분석)

사용자의 학습 패턴을 분석해요:

```
입력: 카테고리별 질문 수, 정답률
출력: 취약점 분석, 학습 추천
```

---

## 3. 30개 테스트 유저 플로우

### 홈페이지 플로우 (1-5)

#### 플로우 1: 첫 방문 → 회원가입
```
1. 앱 접속
2. "시작하기" 버튼 클릭
3. 회원가입 페이지 이동
4. 이메일, 비밀번호 입력
5. 가입 완료
```
**예상 문제**: 이메일 형식이 틀린 경우
**해결책**: "올바른 이메일을 입력해주세요" 메시지 표시

#### 플로우 2: 텍스트로 문제 입력
```
1. 홈페이지 접속
2. 텍스트 입력창에 문제 작성
3. "AI에게 물어보기" 클릭
4. 풀이 페이지로 이동
5. AI 답변 확인
```
**예상 문제**: 빈 텍스트로 제출 시도
**해결책**: 버튼 비활성화, "문제를 입력해주세요" 안내

#### 플로우 3: 이미지로 문제 업로드
```
1. 홈페이지 접속
2. 카메라 또는 갤러리 버튼 클릭
3. 문제 사진 선택
4. 미리보기 확인
5. 제출
```
**예상 문제**: 10MB 초과 이미지 업로드
**해결책**: "10MB 이하 이미지만 가능합니다" 알림

#### 플로우 4: 드래그 앤 드롭 이미지 업로드
```
1. 홈페이지 접속
2. 이미지를 입력창에 드래그
3. 드롭 영역 강조 표시 확인
4. 이미지 놓기
5. 미리보기 표시
```
**예상 문제**: 이미지가 아닌 파일 드롭
**해결책**: "이미지 파일만 업로드 가능합니다" 알림

#### 플로우 5: 이미지 + 텍스트 동시 입력
```
1. 이미지 업로드
2. 추가 설명 텍스트 입력
3. 제출
4. 두 정보 모두 AI에게 전달됨
```
**예상 문제**: 이미지 내용과 텍스트가 다른 문제
**해결책**: AI가 두 정보를 종합해서 판단

---

### 로그인/회원가입 플로우 (6-10)

#### 플로우 6: 이메일 로그인
```
1. 로그인 페이지 접속
2. 이메일, 비밀번호 입력
3. "로그인" 클릭
4. 대시보드로 이동
```
**예상 문제**: 잘못된 비밀번호
**해결책**: "이메일 또는 비밀번호가 틀렸습니다" 표시

#### 플로우 7: 구글 소셜 로그인
```
1. 로그인 페이지 접속
2. "구글로 로그인" 클릭
3. 구글 계정 선택
4. 권한 승인
5. 자동 회원가입 및 로그인
```
**예상 문제**: 구글 서버 오류
**해결책**: "잠시 후 다시 시도해주세요" 표시

#### 플로우 8: 비회원 문제 풀이 시도
```
1. 홈에서 문제 입력
2. 제출 클릭
3. 로그인 페이지로 리다이렉트
4. 로그인 후 원래 문제로 복귀
```
**예상 문제**: 로그인 후 문제가 사라짐
**해결책**: sessionStorage에 임시 저장 후 복원

#### 플로우 9: 회원가입 중 이메일 중복
```
1. 회원가입 페이지
2. 이미 가입된 이메일 입력
3. 제출
4. 중복 안내 표시
```
**예상 문제**: 어떤 방법으로 가입했는지 모름
**해결책**: "이미 가입된 이메일입니다. 로그인해주세요"

#### 플로우 10: 로그아웃
```
1. 네비게이션 바의 프로필 클릭
2. "로그아웃" 클릭
3. 확인 후 홈으로 이동
```
**예상 문제**: 로그아웃 안됨
**해결책**: 클라이언트와 서버 세션 모두 삭제

---

### 문제 풀이 플로우 (11-18)

#### 플로우 11: 텍스트 문제 풀이 전체 과정
```
1. /solve 페이지 접속
2. 문제 텍스트 입력
3. 제출
4. 로딩 애니메이션 표시
5. 에이전트 선택 과정 표시
6. 단계별 풀이 표시
7. 최종 답 확인
```
**예상 문제**: AI 응답이 너무 오래 걸림
**해결책**: 60초 타임아웃 후 "다시 시도해주세요"

#### 플로우 12: 이미지 문제 풀이
```
1. 문제 사진 업로드
2. Vision AI가 이미지 분석
3. 텍스트 추출 결과 확인
4. 전문 에이전트 풀이
5. 결과 표시
```
**예상 문제**: 손글씨 인식 실패
**해결책**: "이미지를 인식하지 못했습니다. 직접 입력해주세요"

#### 플로우 13: 수학 공식 포함 문제
```
1. LaTeX 수식 포함 문제 입력
2. AI 풀이 과정에서 수식 렌더링
3. KaTeX로 예쁘게 표시
```
**예상 문제**: LaTeX 렌더링 오류
**해결책**: 렌더링 실패 시 읽기 쉬운 텍스트로 대체 표시

#### 플로우 14: 회로도 문제
```
1. 시퀀스 회로도 사진 업로드
2. SEQUENCE 에이전트 선택
3. 회로 동작 순서 설명
4. 타이밍 다이어그램 설명
```
**예상 문제**: 복잡한 회로 인식 실패
**해결책**: 부분 인식 결과 표시 + 수동 수정 안내

#### 플로우 15: 재시도 기능
```
1. 풀이 결과 확인
2. "다시 풀기" 버튼 클릭
3. 같은 문제로 새로운 풀이 생성
```
**예상 문제**: 같은 답만 반복
**해결책**: AI에 다양한 접근법 요청

#### 플로우 16: 새 문제 풀기
```
1. 풀이 완료 후 "새 문제" 클릭
2. 입력창 초기화
3. 새 문제 입력
```
**예상 문제**: 이전 문제 기록 사라짐
**해결책**: 대시보드에 기록 저장됨을 안내

#### 플로우 17: 사용 공식 확인
```
1. 풀이 결과에서 "사용 공식" 섹션 확인
2. 공식 칩 클릭
3. 해당 공식 설명 보기
```
**예상 문제**: LaTeX가 그대로 표시됨
**해결책**: latexToPlainText 변환기로 읽기 쉽게 변환

#### 플로우 18: 핵심 포인트 확인
```
1. 풀이 결과 스크롤
2. "핵심 포인트" 섹션 확인
3. 중요 개념 정리 내용 확인
```
**예상 문제**: 핵심 포인트가 비어있음
**해결책**: AI 프롬프트에 필수 항목으로 지정

---

### 대시보드 플로우 (19-26)

#### 플로우 19: 통계 확인
```
1. 대시보드 접속
2. 총 풀이 수 확인
3. 오늘 학습량 확인
4. 연속 학습일 확인
```
**예상 문제**: 통계가 0으로 표시
**해결책**: 로딩 중 스켈레톤 UI, 데이터 없으면 "아직 기록이 없습니다"

#### 플로우 20: 카테고리별 진도 확인
```
1. 카테고리 차트 확인
2. 각 분야별 문제 수 비교
3. 취약 분야 파악
```
**예상 문제**: 차트가 안 보임
**해결책**: 데이터 없으면 빈 차트 + 안내 메시지

#### 플로우 21: AI 학습 분석 요청
```
1. "AI 학습 분석" 버튼 클릭
2. 모달 창 열림
3. 분석 결과 대기
4. 취약점 분석 확인
5. 추천 학습 방향 확인
```
**예상 문제**: 분석 데이터 부족
**해결책**: "최소 5개 이상 문제를 풀어야 분석 가능합니다"

#### 플로우 22: 취약점 기반 학습 시작
```
1. AI 분석에서 취약 분야 확인
2. "학습하러 가기" 클릭
3. 해당 카테고리 필터된 풀이 페이지로 이동
```
**예상 문제**: 해당 카테고리 문제가 없음
**해결책**: 일반 풀이 페이지로 이동 + 카테고리 추천

#### 플로우 23: 풀이 이력 확인
```
1. "최근 풀이 이력" 스크롤
2. 과거 문제들 확인
3. 답변 펼쳐보기
```
**예상 문제**: 이력이 너무 많음
**해결책**: 10개씩 페이지네이션, "더 보기" 버튼

#### 플로우 24: 풀이 기록 삭제
```
1. 이력에서 삭제할 항목 선택
2. 삭제 버튼 클릭
3. 확인 후 삭제
4. 통계 자동 업데이트
```
**예상 문제**: 실수로 삭제
**해결책**: 삭제 전 "정말 삭제하시겠습니까?" 확인

#### 플로우 25: 정답/오답 표시
```
1. 풀이 이력에서 문제 확인
2. "맞음" 또는 "틀림" 버튼 클릭
3. 통계에 반영
```
**예상 문제**: 버튼이 반응 없음
**해결책**: 클릭 시 즉시 UI 업데이트 + 백그라운드 저장

#### 플로우 26: 최근 7일 활동 확인
```
1. 활동 히트맵 확인
2. 일별 학습량 색상으로 확인
3. 학습 패턴 파악
```
**예상 문제**: 날짜가 잘못 표시
**해결책**: 한국 시간대(KST) 기준으로 표시

---

### 기타 플로우 (27-30)

#### 플로우 27: 모바일에서 사용
```
1. 휴대폰 브라우저로 접속
2. 반응형 레이아웃 확인
3. 터치로 조작
```
**예상 문제**: 버튼이 너무 작음
**해결책**: 최소 44px 터치 영역 확보

#### 플로우 28: 네트워크 오류 상황
```
1. 문제 제출 중 인터넷 끊김
2. 오류 메시지 표시
3. 재연결 후 재시도
```
**예상 문제**: 문제가 중복 제출됨
**해결책**: 제출 버튼 중복 클릭 방지 + 세션 ID로 중복 확인

#### 플로우 29: 긴 풀이 결과 스크롤
```
1. 복잡한 문제의 긴 풀이 확인
2. 부드럽게 스크롤
3. 각 단계 카드 확인
```
**예상 문제**: 스크롤이 끊김
**해결책**: 가상 스크롤 적용, 단계별 lazy loading

#### 플로우 30: 앱 새로고침
```
1. 풀이 중 실수로 새로고침
2. 로그인 상태 유지
3. 마지막 페이지로 복귀
```
**예상 문제**: 입력 중이던 문제 사라짐
**해결책**: 5초마다 자동 저장 (추후 구현)

---

## 4. 공통 예상 문제 및 해결책

### API 관련 문제

| 문제 | 원인 | 해결책 |
|------|------|--------|
| "AI 응답 없음" | Gemini API 과부하 | 재시도 버튼 + 3회 자동 재시도 |
| "로딩이 안 끝남" | 네트워크 타임아웃 | 60초 후 타임아웃 처리 |
| "JSON 파싱 오류" | AI 응답 형식 불일치 | 균형 괄호 파서로 부분 추출 |

### 인증 관련 문제

| 문제 | 원인 | 해결책 |
|------|------|--------|
| "세션 만료" | JWT 토큰 만료 | 자동 갱신 + 재로그인 안내 |
| "권한 없음" | 미로그인 상태 | 로그인 페이지 리다이렉트 |

### UI/UX 문제

| 문제 | 원인 | 해결책 |
|------|------|--------|
| "수식이 깨짐" | KaTeX 렌더링 실패 | 폴백 텍스트 표시 |
| "화면이 하얗게" | 컴포넌트 에러 | ErrorBoundary로 에러 페이지 표시 |

---

## 5. 워크플로우 다이어그램

### 문제 풀이 전체 흐름

```
사용자 입력
    │
    ├─► 텍스트만 ───────────────────┐
    │                               │
    └─► 이미지 포함 ─► Vision AI ───┤
                         │          │
                    텍스트 추출     │
                         │          │
                    카테고리 분류 ◄─┘
                         │
                    에이전트 선택
                    (DESIGN/SEQUENCE/LOAD/POWER/RENEWABLE/KEC)
                         │
                    Solver AI 풀이
                         │
                    JSON 파싱
                         │
                    결과 렌더링
                         │
                    DB 저장
```

### 인증 흐름

```
접속
 │
 └─► 토큰 확인
      │
      ├─► 유효 ─► 대시보드
      │
      └─► 무효/없음 ─► 로그인 페이지
                        │
                        ├─► 이메일/비밀번호
                        │
                        └─► 구글 OAuth
                              │
                              └─► 성공 ─► 리다이렉트
```

---

## 6. 핵심 코드 위치

| 기능 | 파일 위치 |
|------|----------|
| 홈 히어로 섹션 | `src/components/home/HeroSection.tsx` |
| 문제 풀이 페이지 | `src/app/solve/page.tsx` |
| AI 풀이 표시 | `src/components/solve/SolutionDisplay.tsx` |
| 대시보드 | `src/app/dashboard/page.tsx` |
| AI 분석 모달 | `src/components/dashboard/AnalyticsModal.tsx` |
| Gemini Solver | `src/lib/services/gemini-solver.service.ts` |
| Vision AI | `src/lib/services/vision.service.ts` |
| JSON 파서 | `src/lib/utils/jsonParser.ts` |
| LaTeX 변환 | `src/lib/utils/latexConverter.ts` |
| 인증 훅 | `src/hooks/useAuth.ts` |
| 통계 훅 | `src/hooks/useStats.ts` |

---

## 7. 해커톤 심사위원을 위한 요약

### 이 앱의 핵심 가치

1. **멀티 에이전트 AI**: 6명의 전문가 AI가 각 분야별로 최적의 답변 제공
2. **이미지 인식**: 손글씨, 회로도, 수식을 자동으로 분석
3. **개인화 학습**: AI가 취약점을 분석하고 맞춤 학습 추천
4. **실시간 피드백**: 즉각적인 풀이와 단계별 설명

### 기술적 도전 과제와 해결

| 도전 | 해결 방법 |
|------|----------|
| AI 응답 불안정 | 균형 괄호 JSON 파서로 부분 추출 |
| LaTeX 렌더링 | KaTeX + 폴백 텍스트 이중 처리 |
| 분야별 전문성 | 6개 전문 에이전트 시스템 |
| 사용자 경험 | 단계별 로딩, 에러 처리, 반응형 디자인 |

### 사용된 Gemini 모델

- **gemini-2.0-flash-preview-image-generation**: 이미지 분석 (Vision)
- **gemini-2.5-pro-preview-05-06**: 문제 풀이 (Solver)
- **gemini-2.0-flash**: 학습 분석 (Analytics)

---

*문서 작성일: 2025년 2월*
*버전: 1.0*
